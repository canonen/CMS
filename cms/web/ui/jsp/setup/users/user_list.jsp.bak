<%@ page
	language="java"
	import="com.britemoon.*,
			com.britemoon.cps.*,
			com.britemoon.cps.adm.*,
			java.io.*,java.sql.*,
			java.util.*,org.apache.log4j.*"
	errorPage="../../error_page.jsp"
	contentType="text/html;charset=UTF-8"
%>

<%@ include file="../../header.jsp" %>
<%@ include file="../../validator.jsp"%>
<%! static Logger logger = null;%>
<%
if(logger == null)
{
	logger = Logger.getLogger(this.getClass().getName());
}

AccessPermission can = user.getAccessPermission(ObjectType.USER);

if(!can.bRead)
{
	response.sendRedirect("../../access_denied.jsp");
	return;
}
%>

<HTML>

<HEAD>
	<TITLE>Customer List</TITLE>
	<%@ include file="../../header.html" %>
	<link rel="stylesheet" href="<%=ui.s_css_filename%>" TYPE="text/css">	
	<SCRIPT src="../../../js/scripts.js"></SCRIPT>
<script language="JavaScript" src="/ccps/ui/ooo/script.js"></script>	
</HEAD>

<BODY class="paging_body">
<table width="100%">
	<tr>
		<td class="page_header">Users</td>
	</tr>
</table>
<br>

<%
if(can.bWrite)
{
	%>
<div id="info">
<div id="xsnazzy">
<b class="xtop"><b class="xb1"></b><b class="xb2"></b><b class="xb3"></b><b class="xb4"></b></b>
<div class="xboxcontent">		
	<table cellspacing="0" cellpadding="3" border="0" width="650">
		<tr>
			<td align="left" valign="middle">
				<a href="user_edit.jsp">
			<img border="0" width="45" src="../../../images/45_45_user.png" onmouseout="this.src='../../../images/45_45_user.png'" onmouseover="this.src='../../../images/45_45_userg.png'">				
				<br>New User</a>&nbsp;&nbsp;&nbsp;
			</td>
		</tr>
	</table>
</div>
<b class="xbottom"><b class="xb4"></b><b class="xb3"></b><b class="xb2"></b><b class="xb1"></b></b>
</div>
</div>	
	<br>
	<%
}
%>
<table cellspacing="0" cellpadding="0" width="650" border="0">
	<tr>
		<td class="listHeading" valign="center" nowrap align="left">
			
			<br><br>

<div id="info">
<div id="xsnazzy">
<b class="xtop"><b class="xb1"></b><b class="xb2"></b><b class="xb3"></b><b class="xb4"></b></b>
<div class="xboxcontent">	
			
			<table class="listTable" width="100%" cellpadding="2" cellspacing="0">
				<tr>
					<th>Users&nbsp;	</th>
					<th></th>
					<th></th>
				</tr>				
				<tr>
					<th class="list_name">Name</th>
					<th class="list_name">Phone</th>
					<th class="list_name">Email</th>
				</tr>
			<%
			ConnectionPool cp = null;
			Connection conn = null;
			Statement	stmt = null;
			ResultSet	rs = null; 
			String sSQL = null;

			try
			{
				cp = ConnectionPool.getInstance();
				conn = cp.getConnection(this);
				stmt = conn.createStatement();

				sSQL =
					" SELECT user_id, user_name + ' ' + ISNull(last_name,''), phone, email" +
					" FROM ccps_user" +
					" WHERE cust_id=" + cust.s_cust_id +
					" AND status_id!=" + UserStatus.DELETED +
					" ORDER BY user_name";

 				rs = stmt.executeQuery(sSQL);
				String sUserId = null;
				String sUserName = null;
				String sPhone = null;
				String sEmail = null;
				
				String sClassAppend = "";
				int i = 0;

				while(rs.next())
				{
					if (i % 2 != 0)
					{
						sClassAppend = "_other";
					}
					else
					{
						sClassAppend = "";
					}
					
					i++;
					
					sUserId = rs.getString(1);
					sUserName = new String(rs.getBytes(2), "UTF-8");
					sPhone = new String(rs.getBytes(3), "UTF-8");
					sEmail = new String(rs.getBytes(4), "UTF-8");
					%>
				<tbody id="Id1" onclick="location.href='cust_attr_edit.jsp?attr_id=<%=sAttrId%>'" onmouseover="do_effect('navhover')" onmouseout="do_effect('navoff')">										
				<tr>
					<td class="listItem_Title<%= sClassAppend %>"><a href="user_edit.jsp?user_id=<%= sUserId %>"><%= sUserName %></a></td>
					<td class="listItem_Data<%= sClassAppend %>"><%= sPhone %></td>
					<td class="listItem_Data<%= sClassAppend %>"><%= sEmail %></td>
				</tr>
			</tbody>
					<%
				}
				rs.close();
				
				if (i == 0)
				{
					%>
				<tr>
					<td class="listItem_Title" colspan="3">There are currently no Users</td>
				</tr>
					<%
				}
			}
			catch(Exception ex)
			{
				ex.printStackTrace(new PrintWriter(out));
			}
			finally
			{
				if(conn!=null) cp.free(conn);
			}
			%>
			</table>
</div>
<b class="xbottom"><b class="xb4"></b><b class="xb3"></b><b class="xb2"></b><b class="xb1"></b></b>
</div>
</div>	
</BODY>
</HTML>
